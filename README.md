# ⨳ Feadget Design
**Feadget Design**[^1] основан на идеях **Feature-Sliced Design (FSD)**:
методология по-прежнему использует декомпозицию на слои и вертикальные слайсы, но усиливает фокус на **features** и **widgets** и вводит более строгое разделение их зон ответственности.

## Слои и вертикальные слайсы
Декомпозиция кода на **слои** и **слайсы** — это два взаимодополняющих подхода. Каждый из них предоставляет определённые преимущества в плане организации кода и его модульности.

### Слои
Принцип разделения кода на слои заключается в группировке элементов системы по их **зоне ответственности**. Каждый слой отвечает за конкретный аспект работы: доступ к данным, бизнес-логику или представление данных. Такое разделение улучшает модульность, упрощает поддержку и снижает связанность (coupling) между различными частями системы.

### Вертикальные слайсы
Разделение кода на слайсы обычно предполагает декомпозицию по функциональным сегментам, связанным с конкретной **бизнес-задачей** или **пользовательским сценарием**. В более общем случае слайс может быть выделен просто ради модульности.
<br>Каждый слайс включает все необходимые элементы — от доступа к данным до отображения, но только для реализации одной функции или компонента. Это повышает независимость, уменьшает связанность (coupling), увеличивает сцепленность (cohesion) и улучшает фокусировку на отдельных компонентах или сценариях работы системы.

### Инкапсуляция и публичное API
Инкапсуляция в слоях и слайсах означает скрытие внутренней реализации и предоставление только необходимого функционала через **публичное API**. Публичное API состоит из модулей и функций, которые предназначены для использования другими частями системы. Остальная часть кода считается приватной и доступ снаружи к ней запрещён.

### Зависимости
Зависимость одного слоя от другого организована однонаправленно, при этом циклические зависимости исключены. Использования одного слайса другими не ограничено (кроме ограничений, накладываемых слоями и публичным API).

### Принципы декомпозиции
Декомпозиция на слои и слайсы является универсальной и может быть использована не только в рамках текущей методологии, но и в любой другой. Далее описана структура js-проекта, реализующего такую декомпозицию.

#### Формирование слоёв
На самом верхнем уровне создаются директории под каждый слой.
```
/layer X
/layer Y
/layer Z
```
#### Формирование слайсов
Слои разбиваются на слайсы. У каждого слайса - своя директория.
<br>Если слайс распространяется на несколько слоёв, то директории создаются в каждом слое и имеют одинаковое название и относительный путь.
```
/layer X
    /slice X1
    /slice X2
    /slice XY
        
/layer Y       
    /slice XY
```
Слайсы можно группировать.
```
/layer X
    /group A
        /slice XA1
        /slice XA2

    /group B
        /slice XB1
        /slice XB2
```

#### Публичное API
Публичное API каждого слайса и слоя представляется через файл `index.js`, который содержит реэкспорт необходимых модулей.
```
/layer
    /slice
        public.js
        private.js
        index.js        // re-exports 'public.js'

    index.js            // re-exports 'slice'
```

Если слайсы группируются, публичное API можно разбить на несколько файлов - по одному на каджую группу.
```
/layer
    /group A
        /slice A1
        /slice A2
        index.js        // re-exports 'slice A1' and 'slice A2'
    
    /group B
        /slice B1
        index.js        // re-exports 'slice B1'
```

#### Общий код
Общий код размещается в директориях `shared`. Он может находиться на уровне всех слоёв или быть ограничен только одним из них.
```
/layer A
    /slice A1
    /slice A2
    /shared             // shared for slice A1 and A2

/layer B
    /slice B1
    /slice B2
    /shared             // shared for slice B1 and B2

/shared                 // shared for all in layer A and B
```

## Features 'n' Widgets
### Основные понятия
Методология оперирует двумя основными понятиями: **feature** и **widget**, которые реализуют разные аспекта одного и того же пользовательского сценария.

**Фича** (функция системы) — это набор операций, инструментов и состояний, реализующих **прикладную логику** пользовательского сценария.

Примеры фичей:
- `userAuth` — аутентификация пользователя:
   - операция `login()`;
   - операция `logout()`;
   - контекст `userAuthContext`;
- `userRegistration` — регистрация пользователя:
   - модель `user`;
   - операция `register(user)`;
- `bookLibraryManagement` — управление библиотекой книг:
   - операция `addToLibrary(bookId)`;
   - операция `removeFromLibrary(bookId)`.

**Виджет** - это высокоуровневый самостоятельный UI-компонент с завершённой функциональностью. В большинстве случаев реализует **логику отображения** для одной или нескольких фич.

Примеры виджетов:
- `BookSearchView` — виджет для поиска книги: включает фильтр поиска и отображает список найденных книг;
- `UserRegistrationForm` — предоставляет пользователю форму для регистрации на сайте и выполняет процесс регистрации;
- `TopNavigationBar` — навигация верхнего уровня.

### Декомпозиция
В проекте выделяются 5 слоёв:
| Слой         | Ответственность                              | Использует                |
| -            | -                                            | -                         |
| `app`        | инициализация, маршрутизация, инфраструктура | `pages`                   |
| `pages`      | UI: высокоуровневая композиция               | `widgets`<br>`components` |
| `widgets`    | UI: основная логика                          | `componens`<br>`features` |
| `components` | UI: переиспользуемые компоненты              | `features`                |
| `features`   | прикладная логика                            |                           |

#### Слой `features`
Слайсы фичей.
<br>Фичи не содержат собственных графических компонентов и проектируются таким образом, чтобы их можно было использовать в любом UI.
<br>
В рамках методологии, навигация и отображение данных не рассматриваются как фичи.
<br>
Переиспользуемый код располагается в `features/shared`.

#### Слои `pages`, `widgets` и `components`
Все три слоя реализуют логику отображения и взаимодействия с пользователем: `widgets` отвечают за "как отобразить?", `pages` - за "где отобразить?", а `components` содержит переиспользуемые самостоятельные части виджетов.

`pages`
<br>Содержит слайсы страниц.
<br>Каждая страница является максимально тонкой, отвечает за инфраструктуру, композицию виджетов и настройку навигации.
<br>Переиспользуемый код нахдится в `pages/shared`.

`widgets`
<br>Содержит слайсы виджетов.
<br>Каждый виджет должен быть достаточно независимым, чтобы его можно было размещать на любой странице.
<br>Использование одних виджетов внутри других не запрещается, однако, чтобы сохранять связанность кода низкой, желательно это избегать и создавать их максимально самостоятельными.
<br>Каждый виджет может быть декомпозирован на компоненты до любого уровня.
<br>Переиспользуемые сервисы, хуки и т.п. выносится в `widgets/shared`.

`components`
<br>Слайсы компонентов, переиспользуемых в разных виджетах.
<br>Общий код выносится в `components/shared`.

#### Слой `app`
Самый высокоуровневый слой. Является корнем композиции и отвечает за настройку и запуск приложения, инициализацию общих контекстов и состояний, настраивает маршруты.

#### Директория `shared`
`shared` не является самостоятельным слоем, здесь находится общий для всех слоёв код.

---
[^1]: "feadget" = "feature" + "widget".